<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Anime Episode Selector - Black & White with Watched Episodes</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

    /* Root and base */
    :root {
      --primary-color: #ffffff;
      --primary-dark: #d0d0d0;
      --bg-dark: #000000;
      --bg-darker: #121212;
      --text-primary: #ffffff;
      --text-muted: #bbbbbb;
      --shadow-dark: rgba(255, 255, 255, 0.05);
      --border-radius: 8px;
      --transition-speed: 0.3s;
      --highlight-hover: #dddddd;
      --highlight-selected: #ffffff;
      --highlight-selected-hover: #aaaaaa;
      --watched-opacity: 0.6;
      --watched-color: #888888;
      --watched-icon-color: #95d600;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: var(--bg-dark);
      font-family: 'Poppins', sans-serif;
      color: var(--text-primary);
      display: flex;
      min-height: 100vh;
      overflow: hidden;
    }

    #sidebar {
      width: 280px;
      background: var(--bg-darker);
      box-shadow: 3px 0 12px var(--shadow-dark);
      display: flex;
      flex-direction: column;
      padding: 20px 20px 20px;
      overflow-y: auto;
      user-select: none;
    }

    /* Logo button container adjusted to scale down image */
    #sidebar button#logo-button {
      display: block;
      margin-bottom: 25px;
      user-select: none;
      flex-shrink: 0;
      outline-offset: 3px;
      background: transparent;
      border: none;
      padding: 0;
      cursor: pointer;
      /* Smaller size that keeps aspect ratio but smaller than original 612x408 */
      width: 120px; /* smaller width */
      height: auto;
      border-radius: 12px;
      transition: filter 0.3s ease, box-shadow 0.3s ease;
    }

    /* Image constrained and scaled */
    #sidebar button#logo-button img {
      display: block;
      width: 100%;
      height: auto; /* maintain aspect ratio */
      border-radius: 12px;
      filter: grayscale(100%) brightness(100%) contrast(120%);
      transition: filter 0.3s ease;
      user-select: none;
      pointer-events: none;
    }

    #sidebar button#logo-button:hover,
    #sidebar button#logo-button:focus {
      filter: none;
      box-shadow: 0 0 8px var(--primary-color);
      outline: none;
    }

    #sidebar h2 {
      font-weight: 600;
      font-size: 1.8rem;
      color: var(--primary-color);
      margin: 0 0 15px;
      letter-spacing: 1px;
      user-select: none;
    }

    #episode-list {
      list-style: none;
      margin: 0;
      padding: 0;
      max-height: calc(100vh - 140px);
      overflow-y: auto;
      border-radius: var(--border-radius);
      box-shadow: inset 0 0 8px #ffffff11;
      border: 1px solid #444;
      background: #111111;
    }

    #episode-list li {
      padding: 14px 20px;
      border-left: 4px solid transparent;
      color: var(--text-primary);
      font-weight: 500;
      font-size: 1rem;
      cursor: pointer;
      transition: 
        background-color var(--transition-speed),
        border-color var(--transition-speed),
        color var(--transition-speed);
      user-select: none;
      display: flex;
      align-items: center;
      white-space: nowrap;
      text-shadow: 0 0 4px #000;
      position: relative;
    }

    /* Watched styling: dim text and add check icon */
    #episode-list li.watched {
      opacity: var(--watched-opacity);
      color: var(--watched-color);
    }
    #episode-list li.watched::after {
      content: "âœ“";
      position: absolute;
      right: 14px;
      font-weight: 700;
      color: var(--watched-icon-color);
      font-size: 1.1rem;
      user-select: none;
      text-shadow: none;
    }

    #episode-list li:not(.selected):hover {
      background-color: var(--highlight-hover);
      color: #000;
      border-left-color: var(--highlight-hover);
      text-shadow: none;
      opacity: 1 !important; /* override watched opacity on hover */
    }

    #episode-list li.selected {
      background-color: var(--highlight-selected);
      color: #000;
      border-left-color: var(--highlight-selected);
      font-weight: 700;
      text-shadow: none;
      opacity: 1 !important; /* override watched opacity */
    }

    #episode-list li.selected:hover {
      background-color: var(--highlight-selected-hover);
      border-left-color: var(--highlight-selected-hover);
      color: #222;
      cursor: pointer;
      opacity: 1 !important;
    }

    #episode-list li:focus-visible {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
      background-color: var(--highlight-hover);
      color: #000;
      text-shadow: none;
      opacity: 1 !important;
    }

    main {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 30px 30px;
      background: var(--bg-dark);
      box-shadow: inset 0 0 50px #000000cc;
      position: relative;
      overflow-x: hidden;
    }

    h1 {
      font-weight: 600;
      font-size: 2.8rem;
      margin: 0 0 25px;
      letter-spacing: 2px;
      color: var(--primary-color);
      user-select: none;
      text-align: center;
      width: 100%;
      max-width: 960px;
      text-shadow: 0 0 3px #fff, 0 0 7px #fff;
    }

    #anime-player {
      width: 100%;
      max-width: 960px;
      border-radius: var(--border-radius);
      box-shadow:
        0 0 30px #fff,
        inset 0 0 60px #ffffffcc;
      background-color: #000;
      outline: none;
      user-select: none;
      filter: grayscale(0%);
      transition: filter 0.3s ease;
    }

    #anime-player:focus {
      box-shadow: 0 0 40px #fff, inset 0 0 70px #ffffffcc;
      outline: none;
    }

    #version-wrapper {
      margin-top: 16px;
      width: 100%;
      max-width: 960px;
      display: flex;
      justify-content: flex-start;
      background: #111111;
      padding: 14px 20px;
      border-radius: var(--border-radius);
      box-shadow: 0 4px 20px rgba(255 255 255 / 0.05);
      user-select: none;
      gap: 12px;
    }

    #version-wrapper label {
      font-weight: 600;
      font-size: 1rem;
      color: var(--text-muted);
      align-self: center;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      margin-right: 10px;
    }

    #version-select {
      background-color: #222;
      border: none;
      border-radius: var(--border-radius);
      color: var(--text-primary);
      font-size: 1rem;
      font-weight: 500;
      padding: 9px 14px;
      cursor: pointer;
      outline-offset: 3px;
      box-shadow: inset 0 0 8px #000;
      appearance: none;
      background-image:
        linear-gradient(45deg, transparent 50%, #fff 50%),
        linear-gradient(135deg, #fff 50%, transparent 50%);
      background-position:
        calc(100% - 20px) calc(1.2em + 2px),
        calc(100% - 15px) calc(1.2em + 2px);
      background-size: 5px 5px;
      background-repeat: no-repeat;
      min-width: 100px;
      transition: background-color 0.3s, box-shadow 0.3s;
    }

    #version-select:focus {
      background-color: #333;
      box-shadow: 0 0 12px #fff, inset 0 0 8px #000;
      outline: none;
      color: #fff;
    }

    #version-select option {
      background-color: #222;
      color: var(--text-primary);
      font-weight: 400;
    }

    /* Scrollbar styling for episode list */
    #episode-list::-webkit-scrollbar {
      width: 8px;
    }
    #episode-list::-webkit-scrollbar-track {
      background: #111;
    }
    #episode-list::-webkit-scrollbar-thumb {
      background-color: #bbb;
      border-radius: 10px;
      border: 2px solid #111;
    }

    /* Responsive */
    @media (max-width: 900px) {
      body {
        flex-direction: column;
      }

      #sidebar {
        width: 100%;
        max-height: 200px;
        flex-direction: row;
        padding: 15px 15px 10px;
        box-shadow: none;
        overflow-x: auto;
        overflow-y: hidden;
        align-items: center;
      }

      #sidebar button#logo-button {
        margin: 0 15px 0 0;
        width: 120px; /* keep consistent smaller size */
      }

      #sidebar h2 {
        flex: 1 0 100%;
        font-size: 1.5rem;
        text-align: center;
        margin: 0 0 8px;
      }

      #episode-list {
        max-height: none;
        display: flex;
        gap: 8px;
        overflow-x: auto;
        overflow-y: hidden;
        border: none;
        box-shadow: none;
        background: transparent;
        border-radius: 0;
      }

      #episode-list li {
        white-space: nowrap;
        flex: 0 0 auto;
        border-left: none;
        border-radius: var(--border-radius);
        padding: 8px 14px;
        background-color: transparent;
        text-shadow: none;
        color: var(--text-primary);
        transition: color 0.3s ease, background-color 0.3s ease;
        position: relative;
      }

      #episode-list li.watched::after {
        right: 8px;
        font-size: 1rem;
      }

      #episode-list li:not(.selected):hover {
        background-color: var(--highlight-hover);
        color: #000;
        text-shadow: none;
        opacity: 1 !important;
      }

      #episode-list li.selected {
        background-color: var(--highlight-selected);
        color: #000;
        opacity: 1 !important;
      }

      #episode-list li.selected:hover {
        background-color: var(--highlight-selected-hover);
        color: #222;
      }

      main {
        width: 100%;
        padding: 20px 15px 30px;
      }

      #version-wrapper {
        max-width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>

  <aside id="sidebar" role="complementary" aria-label="Episode selection sidebar">
    <button id="logo-button" aria-label="Go to homepage">
      <img src="https://raw.githubusercontent.com/Skeleton-Archive/cs2-offsets/refs/heads/main/cat.png" alt="Logo" />
    </button>
    <h2>Episodes</h2>
    <ul id="episode-list" tabindex="0" aria-label="Anime episodes list">
      <!-- Episodes dynamically inserted here -->
    </ul>
  </aside>

  <main role="main">
    <h1>Anime Episode Selector</h1>
    <video id="anime-player" controls preload="metadata" tabindex="0" aria-label="Anime video player"></video>
    <div id="version-wrapper" role="region" aria-label="Select version sub or dub">
      <label for="version-select">Version:</label>
      <select id="version-select" aria-describedby="version-desc" aria-label="Select version">
        <option value="sub">Sub</option>
        <option value="dub">Dub</option>
      </select>
      <span id="version-desc" class="sr-only">Select version of the anime: Sub or Dub</span>
    </div>
  </main>

  <script>
    const episodes = {
      1: {
        sub: 'https://drive.google.com/file/d/1uKMD1g66oaGwPNYneuk3nL3RLE25A5pe/preview',
        dub: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4',
      },
      2: {
        sub: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/Sintel.mp4',
        dub: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/TearsOfSteel.mp4',
      },
      3: {
        sub: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4',
        dub: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4',
      },
      4: {
        sub: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.mp4',
        dub: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4',
      },
      5: {
        sub: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerMeltdowns.mp4',
        dub: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/SubaruOutbackOnStreetAndDirt.mp4',
      },
    };

    const epList = document.getElementById('episode-list');
    const versionSelect = document.getElementById('version-select');
    const videoPlayer = document.getElementById('anime-player');
    const videoSource = document.createElement('source');
    videoPlayer.appendChild(videoSource);
    const logoButton = document.getElementById('logo-button');

    let selectedEpisode = null;
    let watchedEpisodes = new Set();

    // Load watched episodes from localStorage (persist between sessions)
    function loadWatched() {
      try {
        const stored = localStorage.getItem('watchedEpisodes');
        if (stored) {
          const arr = JSON.parse(stored);
          if (Array.isArray(arr)) {
            watchedEpisodes = new Set(arr);
          }
        }
      } catch {
        watchedEpisodes = new Set();
      }
    }

    // Save watched episodes to localStorage
    function saveWatched() {
      localStorage.setItem('watchedEpisodes', JSON.stringify([...watchedEpisodes]));
    }

    function populateEpisodes() {
      epList.innerHTML = '';
      Object.keys(episodes).forEach(epNum => {
        const li = document.createElement('li');
        li.textContent = `Episode ${epNum}`;
        li.dataset.episode = epNum;
        li.tabIndex = 0;
        li.setAttribute('role', 'button');
        li.setAttribute('aria-pressed', 'false');
        if (watchedEpisodes.has(epNum)) {
          li.classList.add('watched');
        }
        li.addEventListener('click', () => selectEpisode(epNum));
        li.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            selectEpisode(epNum);
          }
        });
        epList.appendChild(li);
      });
    }

    function selectEpisode(epNum) {
      if (selectedEpisode === epNum) return;
      // Remove old selection
      if (selectedEpisode !== null) {
        const oldSelectedElem = epList.querySelector(`li[data-episode="${selectedEpisode}"]`);
        if (oldSelectedElem) {
          oldSelectedElem.classList.remove('selected');
          oldSelectedElem.setAttribute('aria-pressed', 'false');
        }
      }
      // Set new selection
      selectedEpisode = epNum;
      const newSelectedElem = epList.querySelector(`li[data-episode="${selectedEpisode}"]`);
      if (newSelectedElem) {
        newSelectedElem.classList.add('selected');
        newSelectedElem.setAttribute('aria-pressed', 'true');
        newSelectedElem.scrollIntoView({block: 'nearest', inline: 'nearest'});
      }
      loadVideo();
    }

    function loadVideo() {
      if (selectedEpisode === null) return;
      const ver = versionSelect.value;
      const src = episodes[selectedEpisode] && episodes[selectedEpisode][ver] ? episodes[selectedEpisode][ver] : '';

      if (src) {
        if (videoSource.src !== src) {
          videoSource.src = src;
          videoPlayer.load();
          videoPlayer.play().catch(() => {});
        }
      } else {
        videoSource.src = '';
        videoPlayer.load();
      }
    }

    videoPlayer.addEventListener('ended', () => {
      if (selectedEpisode !== null && !watchedEpisodes.has(selectedEpisode)) {
        watchedEpisodes.add(selectedEpisode);
        saveWatched();
        const li = epList.querySelector(`li[data-episode="${selectedEpisode}"]`);
        if (li) {
          li.classList.add('watched');
        }
      }
    });

    versionSelect.addEventListener('change', () => {
      loadVideo();
      videoPlayer.focus();
    });

    logoButton.addEventListener('click', () => {
      window.location.href = 'https://Syfer-eng.github.io';
    });

    // Initialize
    loadWatched();
    populateEpisodes();
    selectEpisode('1');
    versionSelect.value = 'sub';
  </script>

  <style>
    .sr-only {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0, 0, 0, 0) !important;
      white-space: nowrap !important;
      border: 0 !important;
    }
  </style>
</body>
</html>
